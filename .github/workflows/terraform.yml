name: Terraform static checks

on:
  pull_request:
    paths:
      - "terraform/**"
  push:
    paths:
      - "terraform/**"
  workflow_dispatch:

# We can't run CI tests on Terraform, so use as many static linters as possible

jobs:
  # Validate rendered helm templates against a k8s api-server with a
  # matching version of where we look to deploy.
  #
  terraform-pre-commit:
    runs-on: ubuntu-22.04
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-python@v4
        with:
          python-version-file: ".python-version"

      - name: Install dependencies
        run: pip install pre-commit

      # https://github.com/terraform-linters/setup-tflint
      - name: Install tflint
        uses: terraform-linters/setup-tflint@v3.0.0
        with:
          tflint_version: v0.46.1

      - name: Run terraform pre-commit
        run: pre-commit run --all --config .pre-commit-config-terraform.yaml
